
def postgres(ht="172.16.13.65", db="mefis", **auth):
    """
    Retorna uma conexao com o PostgreSQL.
    Parâmetros:
    
    ht - host (endereço IP ou nome de host onde o banco de dados está hospedado)
    db - database (nome do banco de dados)
    auth - parâmetros de autenticação (usr e pw) conforme abaixo. Devem ser informados como parãmetros nomeados.
        usr - user (nome do usuário para autenticar no banco de dados)
        pw - password (senha do usuário para conexão)
    """
    
    
    usr=auth.setdefault('usr', USR_PG_ROOT)
    pw=auth.setdefault('pw', PWD_PG_ROOT)
    

    
    conn = psycopg2.connect(host=ht,
                            database=db, 
                            user=usr, 
                            password=pw)
    
    engine = create_engine('postgresql://{user}:{password}@{host}:5432/{database}'.format(user=usr, 
                                                                                          password=pw, 
                                                                                          host=ht, 
                                                                                          database=db))
    
    return conn, engine


query = """
    SELECT distinct
    t1.nr_trabalho, t1.nm_trab, t1.obj_trab, t1.justif, 
    t1.tx_rel_atvd, t2.tx_rel_atvd as tx_rel_atvd_completa, t1.tx_constatacao
FROM 
    ptai.com_resultado AS t1
LEFT JOIN 
    ptai.com_resultado_tx_completo AS t2 
ON 
    t1.cd_atvd = t2.cd_atvd 
    AND t1.cd_tip_rel_atvd = t2.cd_tip_rel_atvd  
    AND t1.cd_rel_atvd = t2.cd_rel_atvd 
WHERE 
    t1.nr_trabalho in (49699, 49659, 49664, 51471, 46911, 46712, 47777, 49860, 47588) ;

"""

df_temp = pd.read_sql(query, engine)


   ---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
/tmp/ipykernel_700/2782855730.py in <module>
     16 """
     17 
---> 18 df_temp = pd.read_sql(query, engine)

~/.local/lib/python3.8/site-packages/pandas/io/sql.py in read_sql(sql, con, index_col, coerce_float, params, parse_dates, columns, chunksize)
    588         )
    589     else:
--> 590         return pandas_sql.read_query(
    591             sql,
    592             index_col=index_col,

~/.local/lib/python3.8/site-packages/pandas/io/sql.py in read_query(self, sql, index_col, coerce_float, parse_dates, params, chunksize, dtype)
   1558         args = _convert_params(sql, params)
   1559 
-> 1560         result = self.execute(*args)
   1561         columns = result.keys()
   1562 

~/.local/lib/python3.8/site-packages/pandas/io/sql.py in execute(self, *args, **kwargs)
   1403     def execute(self, *args, **kwargs):
   1404         """Simple passthrough to SQLAlchemy connectable"""
-> 1405         return self.connectable.execution_options().execute(*args, **kwargs)
   1406 
   1407     def read_table(

AttributeError: 'OptionEngine' object has no attribute 'execute'

