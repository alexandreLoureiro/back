import { inject } from '@angular/core';
import { CanActivateFn, Router } from '@angular/router';
import { ServicoLLMService } from './servico-llm.service';
import { Observable, of } from 'rxjs';
import { catchError, map } from 'rxjs/operators';

export const authGuard: CanActivateFn = (route, state) => {
  const service = inject(ServicoLLMService);
  const router = inject(Router);

  // Rota atual em que o usuário tentou entrar
  const goto = state.url; 

  return service.getauthrestfunci(goto).pipe(
    map((response) => {
      if (response && response.user) {
        // Backend retornou { user: ... } => usuário autenticado
        console.log('Usuário autenticado:', response.user);
        return true; // Libera a rota
      } else if (response && response.redirectUrl) {
        // Backend retornou { redirectUrl: ... } => deve redirecionar
        console.warn('Usuário não autenticado. Redirecionando para:', response.redirectUrl);
        // Redireciona o navegador para a URL informada
        window.location.href = response.redirectUrl;
        return false; // Bloqueia a rota
      } else {
        // Nem user nem redirectUrl => Bloqueia sem redirecionar
        console.warn('Usuário não autenticado e sem redirectUrl. Bloqueando acesso.');
        return false;
      }
    }),
    catchError((error) => {
      console.error('Erro ao autenticar:', error);
      // Em caso de erro, bloqueia o acesso
      return of(false);
    })
  );
};
Para que o modelo de LLM considere apenas os casos em que o auditor explicitamente deixou claro que os achados foram regularizados durante o trabalho, e ainda analise as principais constatações para confirmar a regularização, o prompt pode ser formulado de forma mais específica. Veja uma sugestão de prompt aprimorado:

“Analise o seguinte relatório de auditoria e identifique exclusivamente os achados que foram explicitamente declarados como regularizados pelo auditor durante o trabalho. Em seguida, revise as principais constatações para verificar a consistência dessa informação e confirme se os achados realmente foram resolvidos, evitando qualquer ambiguidade com achados não resolvidos. Liste apenas os achados que foram claramente regularizados, detalhando as ações corretivas e o impacto da regularização.”

Esse prompt orienta o modelo a:
	1.	Considerar apenas achados claramente marcados como regularizados.
	2.	Verificar a consistência entre a declaração do auditor e as principais constatações.
	3.	Evitar listar achados que ainda estão pendentes ou não resolvidos.

Caso tenha mais detalhes específicos do relatório, podemos adicionar nuances ao prompt para uma análise ainda mais precisa.



Apresentação do Projeto Aplicado: Defesa Cibernética contra IA Generativa em Ambientes Bancários
01. Apresentação: Quem sou eu?
[INSIRA AQUI SUA APRESENTAÇÃO]
02. Problema: Qual é a dor?
Aumento dos Ataques de Engenharia Social: O setor bancário enfrenta um número crescente de ataques de engenharia social, como phishing, clonagem de voz e mensagens fraudulentas em aplicativos de mensagens. Criminosos cibernéticos estão utilizando IA generativa para criar ataques altamente personalizados, tornando-os mais difíceis de detectar.
Vazamentos de Dados: Criminosos obtêm dados pessoais de clientes de diversas fontes com diferentes níveis de segurança, como órgãos governamentais, pequenas empresas, lojas de varejo, farmácias e postos de gasolina. Essas entidades, muitas vezes, não possuem sistemas de segurança robustos, tornando-se alvos fáceis para vazamentos ou roubo de informações.
IA Generativa: A IA generativa permite a criação de mensagens fraudulentas extremamente convincentes, explorando a confiança e o desconhecimento dos clientes. Ataques personalizados, utilizando dados pessoais obtidos de forma ilícita, são mais eficazes e difíceis de identificar.
Baixa Conscientização: Clientes e funcionários, muitas vezes, não estão cientes das novas técnicas de fraude, tornando-se vulneráveis a ataques. Campanhas de conscientização tradicionais, com abordagens genéricas, não são mais eficazes para treinar os usuários a detectar ataques avançados.
03. Solução: O que eu proponho?
Conscientização como principal linha de defesa: A conscientização de clientes e funcionários é a principal linha de defesa contra fraudes sofisticadas. É crucial que os clientes estejam preparados para reconhecer e evitar comunicações fraudulentas.
Campanhas Educacionais e Treinamento: O projeto visa implementar campanhas educacionais e treinamentos para ajudar clientes e colaboradores a identificar e evitar fraudes. Simulações realistas e treinamentos regulares são fundamentais para aumentar a resiliência.
Simulação de Ataques: A simulação de ataques de phishing personalizados, utilizando a API da OpenAI, permite educar os usuários sobre as táticas dos criminosos. Através da criação de modelos de e-mails fraudulentos que imitam comunicações de instituições financeiras, é possível demonstrar como os ataques ocorrem na prática.
Ferramentas de Detecção Automatizada: A implementação de ferramentas de detecção automatizada de fraudes complementa a conscientização dos usuários. Essas ferramentas auxiliam na identificação de atividades suspeitas e na prevenção de fraudes.
04. Diferencial: O que a sua solução tem de especial?
Abordagem proativa e centrada no usuário: O projeto se concentra em capacitar clientes e funcionários, tornando-os a primeira linha de defesa. A educação e conscientização são ferramentas proativas que permitem aos usuários se protegerem de forma independente.
Combinação de Tecnologia e Educação: A solução integra ferramentas de detecção automatizada com campanhas de conscientização. Essa abordagem multifacetada garante uma proteção mais abrangente contra fraudes.
Foco em Ameaças Emergentes: O projeto aborda as ameaças mais recentes, utilizando IA generativa. Através da simulação de ataques personalizados, os usuários são preparados para as táticas mais sofisticadas.
05. Impacto: Como funciona o seu produto?
1. Conscientização: Campanhas educacionais abrangentes, utilizando diversos canais de comunicação, como e-mail, SMS, notificações em aplicativos e redes sociais.
2. Treinamento: Simulações de ataques de phishing personalizados para demonstrar as técnicas dos criminosos e como identificá-las.
3. Detecção: Implementação de ferramentas automatizadas para identificar e bloquear atividades suspeitas em tempo real.
06. Próximos Passos: Qual a sua visão para o futuro da solução?
Continuidade das Campanhas: É essencial manter as campanhas de conscientização atualizadas para garantir a proteção contra as ameaças em constante evolução. As campanhas devem abordar as novas técnicas de phishing que utilizam IA generativa.
Expansão do Alcance: É preciso alcançar um público maior por meio de diferentes canais de comunicação e abordagens inovadoras. A utilização de plataformas online, como mídias sociais e aplicativos de mensagens, pode aumentar o alcance das campanhas.
Feedback Contínuo: Coletar feedback dos clientes e colaboradores é crucial para aprimorar as estratégias educacionais. Pesquisas de satisfação, grupos focais e análise de dados de interação com os materiais educativos podem fornecer insights valiosos.
Parcerias Estratégicas: Explorar colaborações com órgãos governamentais, entidades reguladoras e outras instituições permite fortalecer a segurança em todo o setor financeiro. A troca de informações e melhores práticas contribui para a criação de um ambiente mais seguro para todos.
Observação: As informações para a seção "01. Apresentação: Quem sou eu?" não estão disponíveis nos documentos fornecidos. Adapte esta seção com suas informações pessoais e profissionais.


=======

Aqui está a estrutura do conteúdo em texto para cada slide. Você pode usar este material para transferir rapidamente para qualquer programa de slides:

---

### Slide 1: Apresentação - Quem Sou Eu?
- **Título:** Alexandre Loureiro
- **Descrição:** Pós-graduando em Segurança Cibernética. Experiência em desenvolvimento de soluções para o setor financeiro, focando na defesa contra ataques usando IA generativa.
- **Imagem:** Uma imagem pessoal que represente seu perfil profissional.

---

### Slide 2: Problema - Qual é a dor?
- **Título:** Problema de Segurança Cibernética
- **Descrição:** O setor financeiro enfrenta um aumento em ataques de phishing altamente personalizados. Criminosos obtêm dados pessoais de clientes e usam IA generativa para criar e-mails convincentes, simulando comunicações bancárias e solicitando informações confidenciais.
- **Destaques:**
  - Vazamento de dados em fontes externas.
  - Sofisticação dos ataques de phishing.
  - Baixa conscientização entre clientes e colaboradores.

---

### Slide 3: Solução - O que eu proponho?
- **Título:** Solução Proposta
- **Descrição:** Um sistema de defesa cibernética que combina:
  - **Conscientização e Treinamento:** Para clientes e funcionários, incluindo simulações práticas.
  - **Uso de IA Generativa:** Para criar exemplos realistas de phishing e treinar reconhecimento de ataques.
  - **Framework POEMS:** Análise do ambiente bancário considerando aspectos de pessoas, objetos, ambiente, mensagens e serviços.

---

### Slide 4: Diferencial - O que a sua solução tem de especial?
- **Título:** Diferenciais
- **Diferenciais:** 
  - **Simulações Realistas:** Treinamento usando IA para replicar ataques reais.
  - **Alinhamento com LGPD:** Conformidade com a proteção de dados e privacidade.
  - **Treinamento Contínuo:** Desenvolvimento de campanhas constantes para manter a defesa contra novas ameaças.
- **Framework POEMS:** Abordagem completa que inclui todos os envolvidos no sistema bancário.

---

### Slide 5: Impacto - Como funciona o seu produto?
- **Título:** Impactos Esperados
- **Descrição:** A solução prevê os seguintes impactos:
  1. **Maior Conscientização:** Aumento na taxa de identificação de fraudes pelos clientes.
  2. **Redução de Prejuízos:** Menor incidência de fraudes bem-sucedidas.
  3. **Fortalecimento da Confiança:** Reforça a imagem de segurança da instituição.

---

### Slide 6: Próximos Passos - Qual a sua visão para o futuro da solução?
- **Título:** Próximos Passos
- **Descrição:** 
  - **Continuidade das Campanhas:** Ampliação do alcance das campanhas educacionais.
  - **Feedback Contínuo:** Coleta de feedback de clientes e colaboradores para aprimorar os materiais educativos.
  - **Parcerias Estratégicas:** Colaboração com órgãos reguladores e outros bancos para fortalecer a segurança do setor financeiro.

---

Essa estrutura cobre todos os pontos essenciais do seu projeto. Boa sorte com a apresentação!



===============


Sim, incluir os exemplos de scripts Python é uma excelente ideia para ilustrar a parte prática do projeto! Vou acrescentar um slide específico para isso, detalhando como esses scripts são usados para simular ataques de phishing. Aqui vai a atualização:

---

### Slide 7: Implementação Prática - Simulação de Ataques com Python
- **Título:** Exemplo de Simulação com Python
- **Descrição:** Demonstração de scripts que simulam ataques de phishing para fins de treinamento.
  - **Objetivo do Script:** Gerar e-mails simulados que replicam técnicas de phishing, ajudando a conscientizar os usuários sobre como identificar esses ataques.
- **Exemplo de Código (Python):**
  ```python
  import openai

  openai.api_key = 'sua_chave_api'

  def gerar_email_phishing(nome_cliente, banco):
      prompt = f"Escreva um e-mail de phishing para {nome_cliente} se passando pelo {banco}."
      resposta = openai.Completion.create(engine="text-davinci-003", prompt=prompt, max_tokens=150)
      return resposta.choices[0].text.strip()

  # Exemplo de uso
  email_simulado = gerar_email_phishing("João Silva", "Banco XYZ")
  print(email_simulado)
  ```
  - **Funcionalidade:** O script gera e-mails com tom convincente e personalizado, simulando uma comunicação legítima de um banco.

---

Este slide adiciona valor prático ao seu pitch e demonstra a aplicação real da IA para fins de conscientização em segurança cibernética.



===========


import openai

openai.api_key = 'sua_chave_api'

def gerar_email_phishing(nome_cliente, banco):
    prompt = f"Escreva um e-mail de phishing para {nome_cliente} se passando pelo {banco}."
    resposta = openai.Completion.create(engine="text-davinci-003", prompt=prompt, max_tokens=150)
    return resposta.choices[0].text.strip()

# Exemplo de uso
email_simulado = gerar_email_phishing("João Silva", "Banco XYZ")
print(email_simulado)
