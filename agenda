SELECT 
    periodo_apuracao,
    string_agg('relatorio: ' || relatorio_text_extract, ' ') AS relatorios_periodo
FROM 
    rcm.rcm_kpmg_relatorios
WHERE 
    sumario_executivo_per IS NULL
GROUP BY 
    periodo_apuracao;

from sqlalchemy import text

# Query de update usando o campo periodo_apuracao
update_query = text("""
    UPDATE rcm.rcm_kpmg_relatorios
    SET 
        sumario_executivo_per = :sumario_executivo_per,
        racional_sumario_per = :racional_sumario_per
    WHERE periodo_apuracao = :periodo_apuracao
""")

# Exemplo: iterando sobre o DataFrame df_gpt_period para atualizar cada registro
with engine.begin() as connection:
    for index, row in df_gpt_period.iterrows():
        params = {
            'sumario_executivo_per': row['sumario_executivo_per'] or '',
            'racional_sumario_per': row['racional_sumario_per'] or '',
            'periodo_apuracao': row['periodo_apuracao']
        }
        result = connection.execute(update_query, **params)
        print(f"Registro atualizado para periodo_apuracao: {row['periodo_apuracao']} - Linhas afetadas: {result.rowcount}")

print("Atualização dos relatórios por período concluída.")
