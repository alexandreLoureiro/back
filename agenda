<div class="container-fluid p-3">
  <!-- Cabeçalho com informações do período -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <div class="d-flex justify-content-between align-items-center">
        <h4 class="mb-0">Relatórios de Auditoria Externa - Período: {{objetoAudDetalhes?.periodo_apuracao}}</h4>
      </div>
    </div>
    
    <div class="card-body" *ngIf="objetoAudDetalhes">
      <!-- Sumário executivo do período (consolidado) -->
      <div class="mb-4">
        <h5 class="border-bottom pb-2 text-primary">Sumário Executivo do Período</h5>
        <div class="p-3 bg-light rounded" [innerHTML]="objetoAudDetalhes.sumario_executivo_per"></div>
        
        <div class="mt-3">
          <p-accordion>
            <p-accordionTab header="Racional da Análise">
              <pre class="p-2 bg-light rounded">{{ objetoAudDetalhes.racional_sumario_per }}</pre>
            </p-accordionTab>
          </p-accordion>
        </div>
      </div>
      
      <!-- Lista de relatórios no período -->
      <div class="mb-4">
        <h5 class="border-bottom pb-2 text-primary">Relatórios Analisados</h5>
        <div class="p-3 bg-light rounded">
          <pre>{{ objetoAudDetalhes.relatorios_periodo }}</pre>
        </div>
      </div>
      
      <!-- Botão para iniciar conversa com o chatbot -->
      <div class="d-flex justify-content-center mt-4">
        <p-button 
          label="Iniciar Conversa com Chatbot de Auditoria" 
          icon="pi pi-comments" 
          styleClass="p-button-lg"
          (onClick)="iniciarChatbot()">
        </p-button>
      </div>
    </div>
    
    <div class="card-body d-flex justify-content-center" *ngIf="!objetoAudDetalhes">
      <p-progressSpinner strokeWidth="4" animationDuration=".5s"></p-progressSpinner>
    </div>
  </div>
  
  <!-- Chat interface (opcional - pode ser exibido quando iniciarChatbot() for chamado) -->
  <div class="card" *ngIf="chatVisible">
    <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Assistente de Auditoria</h5>
      <button class="btn btn-sm btn-outline-light" (click)="chatVisible = false">
        <i class="pi pi-times"></i>
      </button>
    </div>
    
    <div class="card-body chat-container" style="height: 400px; overflow-y: auto;">
      <!-- Mensagem inicial do assistente -->
      <div class="chat-message assistant-message mb-3">
        <div class="message-content p-3 rounded" [innerHTML]="objetoAudDetalhes.role_assistant"></div>
      </div>
      
      <!-- Histórico de mensagens (dinâmico) -->
      <div *ngFor="let msg of chatMessages" class="chat-message mb-3" [ngClass]="{'user-message': msg.role === 'user', 'assistant-message': msg.role === 'assistant'}">
        <div class="message-content p-3 rounded" [innerHTML]="msg.content"></div>
      </div>
    </div>
    
    <div class="card-footer">
      <div class="input-group">
        <input 
          type="text" 
          class="form-control" 
          placeholder="Digite sua pergunta sobre a auditoria..." 
          [(ngModel)]="userMessage"
          (keyup.enter)="enviarMensagem()">
        <button class="btn btn-primary" (click)="enviarMensagem()">
          <i class="pi pi-send"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<style>
.chat-message {
  display: flex;
  margin-bottom: 10px;
}

.user-message {
  justify-content: flex-end;
}

.user-message .message-content {
  background-color: #e3f2fd;
  max-width: 80%;
}

.assistant-message .message-content {
  background-color: #f5f5f5;
  max-width: 80%;
}
</style>
